## 三个注册中心异同点

    |  组件名| 语言 |CAP| 组服务健康检查| 对外暴露接口 |Spring Cloud 集成|
    |--|--|--|--|--|--|
    |   Eureka  |   Java  |   AP  |   可配支持   |  HTTP  |  已集成
    |   Consul  |   Go  |   CP  |   支持   |  HTTP/DNS  |  已集成
    |   Zookeeper  |   Java  |   CP  |   支持   |  客户端  |  已集成
    
- CAP

  > C（Consistency）强一致性
  >
  > A（Availability）可用性
  >
  > P（Partition tolerance）分区容错性

  `最多只能同时较好的满足两个。`

  CAP理论的的核心：一个分布式系统不可能同时很好的满足一致性、可用性和分区容错性这三个需求。因此，根据CAP原理将NoSQL 数据库分成了满足CA原则，满足CP原则和满足AP原则三大类：

  - CA ：单点集群，满足一致性，可用性的系统，通常性能不是特别高；RDBMS
  - CP ：满足一致性，分区容错性的系统，同城性能不是特别高；MongoDB、HBase、Reids
  - AP ：满足可用性，分区容错性的系统，通常可能对一致性要求低一些；大多数网站架构的选择

- CAP 的 3 进 2

  CAP理论就是说在分布式存储系统中，最多只能实现上面的两点。由于当前的网络硬件肯定会出现延迟丢包等问题，所以`分区容错性是我们必须需要实现的。`所以我们只能在 `一致性`和`可用性`之间进行权衡，没有NOSQL系统能同时保证这三点。

- `作为服务注册中心，Eureka比Zookeeper好在哪里`

  - zookeeper 保证CP

    当向注册中心查询服务列表时，我们可以容忍注册中心返回的是几分钟以前的注册信息，但不能接受服务直接宕掉不可用。也就是说，服务注册功能对可用性的要求高于一致性。但是zk会出现这样一种情况，当master节点因为网络故障与其它节点失去联系时，剩余节点会重新进行leader选举。问题在于，选举leader的时间太长，30 ~ 120s，且选举期间整个zk集群都是不可用的，这就导致在选举期间注册服务瘫痪。在云部署的环境下，因网络问题使得zk集群失去master节点是较大概率会发生的值，虽然服务能够最终恢复，但是漫长的选举时间导致的注册长期不可用是不能容忍的。

  - Eureka 保证AP

    Eureka 看明白了这一点，因此在设计时就优先保证可用性。`Eureka各个节点都是平等的，`几个节点挂掉不会影响正常节点的工作，剩余的节点依然可以提供注册和查询服务。而Eureka的客户端在向某个Eureka注册或如果发现连接失败，则会自动切换至其它节点，只要有一台Eureka 还在，就能保证注册服务可用（保证可用性），只不过查到的信息可能不是最新的（不保证强一致性）。除此之外，Eureka 还有一种自我保护机制，如果15分钟内超过85%的节点都没有正常的心跳，那么Eureka就认为客户端与注册中心出现了网络故障，此时会出现以下几种情况：

    ​	1.Eureka 不再从注册列表中移除因为长时间没有收到心跳而应该过期的服务

    ​	2.Eureka 仍然能够接受新服务的注册和查询请求，但是不会被同步到其它节点上（既保证当前的节点依然可用）

    ​	3.当网络稳定时，当前实例新的注册信息会被同步到其它节点中

    `因此，Eureka可以很好的对应因网络故障导致部分节点失去联系的情况，而不会像Zookeeper那样使整个注册服务瘫痪。`